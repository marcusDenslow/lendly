{% extends 'skiutlan/base.html' %}

{% block title %}{{ bruker.fornavn }} {{ bruker.etternavn }} - Skiutlån System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h2>{{ bruker.fornavn }} {{ bruker.etternavn }}</h2>
            </div>
            <div class="card-body">
                <p><strong>Telefon:</strong> {{ bruker.telefon }}</p>
                <p><strong>E-post:</strong> {{ bruker.epost|default:"Ikke oppgitt" }}</p>
                <p><strong>Registrert:</strong> {{ bruker.registrert|date:"d.m.Y H:i" }}</p>
                <p><strong>Aktive utlån:</strong> {{ antall_aktive }}</p>

                <div class="mt-3">
                    <a href="{% url 'skiutlan:bruker_rediger' bruker.id %}" class="btn btn-primary">Rediger</a>
                    <a href="{% url 'skiutlan:utlan_opprett' %}?bruker={{ bruker.id }}" class="btn btn-success">Nytt utlån</a>
                    <a href="{% url 'skiutlan:bruker_slett' bruker.id %}" class="btn btn-danger">Slett</a>
                    <a href="{% url 'skiutlan:bruker_liste' %}" class="btn btn-secondary">Tilbake til liste</a>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Aktive utlån ({{ aktive_utlan.count }})</h5>
            </div>
            <div class="card-body">
                {% if aktive_utlan %}
                    {% for utlan in aktive_utlan %}
                        <div class="border-bottom pb-2 mb-2">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="mb-1">{{ utlan.ski_item.navn }}</h6>
                                    <small class="text-muted">
                                        {{ utlan.ski_item.get_type_ski_display }} -
                                        {{ utlan.ski_item.storrelse }}{% if utlan.ski_item.type_ski == 'stovler' %}EU{% else %}cm{% endif %} -
                                        {{ utlan.ski_item.get_tilstand_display }}
                                    </small>
                                    <br>
                                    <small class="text-muted">
                                        Lånt: {{ utlan.utlant_dato|date:"d.m.Y" }} | Planlagt retur: {{ utlan.planlagt_retur|date:"d.m.Y" }}
                                    </small>
                                </div>
                                <div>
                                    <a href="{% url 'skiutlan:utlan_marker_returnert' utlan.id %}" class="btn btn-sm btn-success">Returner</a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted">Ingen aktive utlån</p>
                {% endif %}
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h5>Utlånshistorie</h5>
            </div>
            <div class="card-body">
                {% if utlan_historie %}
                    {% for utlan in utlan_historie|slice:":5" %}
                        <div class="border-bottom pb-2 mb-2">
                            <h6 class="mb-1">{{ utlan.ski_item.navn }}</h6>
                            <small class="text-muted">
                                {{ utlan.ski_item.get_type_ski_display }} -
                                {{ utlan.ski_item.storrelse }}{% if utlan.ski_item.type_ski == 'stovler' %}EU{% else %}cm{% endif %} -
                                {{ utlan.ski_item.get_tilstand_display }}
                            </small>
                            <br>
                            <small class="text-muted">
                                Lånt: {{ utlan.utlant_dato|date:"d.m.Y" }} | Returnert: {{ utlan.returnert_dato|date:"d.m.Y" }}
                            </small>
                        </div>
                    {% endfor %}
                    {% if utlan_historie.count > 5 %}
                        <small class="text-muted">... og {{ utlan_historie.count|add:"-5" }} til</small>
                    {% endif %}
                {% else %}
                    <p class="text-muted">Ingen tidligere utlån</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}